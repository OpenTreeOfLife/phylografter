{{extend 'layout.html'}}

<h4 style="padding-bottom:0.5em;color:dimgray">
<span style="font-weight:bold">Create new study record</span>
(trees, files, and tags added later)
</h4>

<script type="text/javascript">
$(document).ready(function(){
    $('#doi_ajax_spinner').hide();
	$("#populate_from_doi").click(function() {
		var study_doi_url = "{{=URL(request.controller, 'ref_from_doi')}}" + "/" + $("#study_doi").val() + ".json" ;
        $("#doi_ajax_spinner").show();
		$.ajax({
			url : study_doi_url,
			dataType : 'json',
//			headers : {
//				Accept : 'application/vnd.citationstyles.csl+json, application/rdf+json',
//			},
			contentType : 'application/json',
			success : function(data, textStatus, jqXHR) {
				$("#study_citation").val(data.citation);
				$("#study_year_published").val(data.year);
				$("#doi_ajax_spinner").hide();
			},
			error : function(jqXHR, textStatus, errorThrown) {
				$(".flash").html("DOI lookup error: " + jqXHR.statusText).slideDown();
				$("#doi_ajax_spinner").hide();
			}
		});
	});
    $('#populate_from_doi').hide();
	$("#study_doi").keyup(function() {
		//var study_doi_empty = $("#study_doi").val() == "";
		//$("#populate_from_doi").attr('disabled', study_doi_empty);
		if ($("#study_doi").val() == "") {
		    $("#populate_from_doi").hide();
		}
		else {
		    $("#populate_from_doi").show();
		}
	});
});
</script>
{{=form}}

